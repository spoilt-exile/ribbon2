<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Message editor</title>
        <h:outputStylesheet library="webjars" name="primeflex/2.0.0/primeflex.min.css" />
    </h:head>
    <h:body>
        <style>
            .ui-chips {
                width: 100%;
            }
            .ui-picklist .ui-picklist-list{
                height: 400px;
            }
            .ui-inputtextarea {
                height: 400px;
                width: 100%;
            }
        </style>
        <script>
            
        </script>
        <h:form id="message-editor">
            <div class="ui-g">
                <div class="ui-g-6">
                    <h5>Header</h5>
                    <p:inputText style="width:100%" value="#{editor.header}" 
                                 required="true" requiredMessage="Header required"/>
                </div>

                <div class="ui-g-6">
                    <h5>Tags</h5>
                    <p:chips inputStyle="width:100%" unique="true" 
                             value="#{editor.tags}" addOnPaste="true" separator=","/>
                </div>
            </div>

            <div class="ui-g">
                <div class="ui-g-6">
                    <h5>Directories</h5>
                    <p:pickList id="directories" value="#{editor.directories}" 
                                var="directories" itemLabel="#{directories}" 
                                itemValue="#{directories}" required="true" 
                                requiredMessage="Select at least one directory" 
                                responsive="true"/>
                </div>
                <div class="ui-g-6">
                    <h5>Add properties</h5>
                    <p:fragment update="true">
                    <p:commandButton value="Add new property" process="@this" update="newProperties"
                                     action="#{editor.addNewProperty()}" 
                                     oncomplete="jQuery('#message-editor\\:newProperties tr').last().find('span.ui-icon-pencil').each(function(){jQuery(this).click()});"/>
                    <p:commandButton value="Remove property" process="@this" update="newProperties"
                                     action="#{editor.removeNewProperty()}"/>
                    <p:dataTable id="newProperties" widgetVar="newProperties" editable="true"
                                 selectionMode="single" selection="#{editor.selectedProperty}"
                                 rowKey="#{newProperty.content}"
                                 value="#{editor.newProperties}" var="newProperty">
                        <p:column headerText="Type">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{newProperty.type}"/></f:facet>
                                <f:facet name="input">
                                    <h:selectOneMenu value="#{newProperty.type}" style="width:100%">
                                        <f:selectItems value="#{editor.allowedPropertyTypes}" var="type"
                                                       itemLabel="#{type}" itemValue="#{type}"/>
                                    </h:selectOneMenu>
                                </f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column headerText="Content">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{newProperty.content}"/></f:facet>
                                <f:facet name="input"><p:inputText value="#{newProperty.content}" style="width:100%"/></f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column style="width:6rem">
                            <p:rowEditor/>
                        </p:column>
                    </p:dataTable>
                    </p:fragment>
                </div>
            </div>
            <p:inputTextarea autoResize="true" value="#{editor.content}" 
                             required="true" requiredMessage="Content required"/>
            
            <p:commandButton value="Save" ajax="false" action="#{editor.save()}" />
            
            <p:accordionPanel activeIndex="-2">
                <p:tab title="Existing properties">
                    <p:dataTable value="#{editor.existingProperties}" var="property" 
                                 lazy="true">
                        <p:column headerText="UID" style="min-width: 200px; width: auto;">
                            <h:outputText value="#{property.uid}" />
                        </p:column>
                        <p:column headerText="Type" style="min-width: 100px; width: auto;">
                            <h:outputText value="#{property.type}" />
                        </p:column>
                        <p:column headerText="Created by" style="min-width: 100px; width: auto;">
                            <h:outputText value="#{property.createdBy}" />
                        </p:column>
                        <p:column headerText="Created" style="min-width: 200px; width: auto;">
                            <h:outputText value="#{property.created}" />
                        </p:column>
                        <p:column headerText="Content" style="min-width: 200px; width: auto;">
                            <h:outputText value="#{property.content}" />
                        </p:column>
                    </p:dataTable>
                </p:tab>
            </p:accordionPanel>
        </h:form>
    </h:body>
</html>
